

# blow away local changes before a git pullgit reset --hard HEAD
git clean -fd
git pull



# I wont need shit shit on EC2 host anymore
sudo apt remove nodejs npm -y









Prod Deploy Procedure:

ðŸ”¹ Step 1: Pull latest code
cd ~/MarginWatch
git pull

ðŸ”¹ Step 2: Build the frontend
cd frontend
npm install           # only needed after package changes
npm run build         # uses output: 'export' in next.config.ts

ðŸ”¹ Step 3: Confirm static site output
ls -l ./out           # should contain index.html, etc.


ðŸ”¹ Step 4: Nginx auto-serves it
- ./frontend/out:/usr/share/nginx/html:ro































 run the program here from my own command line inside docker
docker exec marginwatch-app /app/script.sh

 cron job from EC2 container
0 * * * * docker exec marginwatch-app /app/script.sh >> /var/log/marginwatch.log 2>&1


python main.py 2025-04-29-15-20-00-margin_futures_fops.html
python main.py /Users/esavage/AllanSavageDev/MarginWatch/IB_margin_files/2025-04-29-16-10-12-margin_futures_fops.html


	var us_fut_tables = ["cmecrypto", "cfecrypto", "cfe", "ecbot", "elx", "iceus", "globex", "nymex", "cme", "nybot", "nyseliffe", "cbot", "eris", "ICECRYPTO", "QBALGOIUS", "smfe"];
	var ca_fut_tables = ["cde"];
	var eu_fut_tables = ["belfox", "dtb", "fta", "iceeu", "iceeusoft", "idem", "ipe", "lmeotc", "matif", "meffrv", "monep", "oms", "soffex", "eurexus", "liffe", "liffe_nf", "lssf", "tom", "QBALGOIEU", "wse"];
	var au_fut_tables = ["snfe"];
	var hk_fut_tables = ["hkfe"];
	var jp_fut_tables = ["osejpn", "tsej"];
	var in_fut_tables = ["nse"];
	var mx_fut_tables = ["mexder"];
	var sg_fut_tables = ["sgx"];
	var kr_fut_tables = ["kse"];




"cmecrypto", "cfecrypto", "cfe", "ecbot", "elx", "iceus", "globex", "nymex", "cme", "nybot", "nyseliffe", "cbot", "eris", "ICECRYPTO", "QBALGOIUS", "smfe"
	"cde"
	"belfox", "dtb", "fta", "iceeu", "iceeusoft", "idem", "ipe", "lmeotc", "matif", "meffrv", "monep", "oms", "soffex", "eurexus", "liffe", "liffe_nf", "lssf", "tom", "QBALGOIEU", "wse"
	"snfe"
	"hkfe"
	"osejpn", "tsej"
	"nse"
	"mexder"
	"sgx"
	"kse"




ssh -i ~/AwsCreds/T5_Main.pem ubuntu@trader5.link

ssh -i ~/AwsCreds/allan_savage_key.pem ubuntu@3.149.214.167
ssh -i ~/AwsCreds/allan_savage_key.pem allan@3.149.214.167

docker exec -it marginwatch-backend bash


# this runs the front end build - I do this locally from ./frontend 
# first command will put output in ./frontend/.next ( which I need to add to git ignore )
# second commadn will produce fully static site in ./frontend/out ( which I need to add to git ignore )
# if I mount ./frontend/out for nginx it will serve my site 
npm run build && npx next export

# to build the frontend
cd marginwatch/frontend/app
npm install        # only needed once or when deps change
npm run build



cd frontend
npm run build 

 â¨¯ 
    `next export` has been removed in favor of 'output: export' in next.config.js.
Learn more: https://nextjs.org/docs/app/building-your-application/deploying/static-exports

#output lands in 
frontend/out/

so nginx should mount:
- ./frontend/out:/usr/share/nginx/html:ro















sudo apt install -y git docker.io docker-compose nginx 


2025-04-30-23-45-58-margin_futures_fops.html
docker exec marginwatch-backend python main.py IB_margin_files/<your_file_name.html>

docker exec marginwatch-backend fetch_IB_margin_file.sh
docker exec marginwatch-backend python main.py IB_margin_files/2025-04-30-23-45-58-margin_futures_fops.html


docker exec marginwatch-backend bash fetch_IB_margin_file.sh
docker exec marginwatch-backend ls IB_margin_files

2025-05-01-00-22-28-margin_futures_fops.html

docker exec marginwatch-backend python main.py IB_margin_files/2025-05-01-00-22-28-margin_futures_fops.html

http://3.149.214.167:8080/




curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs








cd ~/MarginWatch
git pull origin main

docker-compose down --volumes --remove-orphans
docker image rm marginwatch_backend || true
docker-compose up --build -d





Deploy cycle:

git add .
git commit -m "Debug run_all.sh not executing main.py"
git push origin main


cd ~/MarginWatch
git pull origin main
#docker-compose down --volumes --remove-orphans
docker-compose down --remove-orphans
docker image rm marginwatch_backend || true
docker-compose up --build -d










docker exec marginwatch-backend bash fetch_IB_margin_file.sh
docker exec marginwatch-backend python main.py










npx create-next-app@latest frontend --typescript --tailwind --eslint --yes

cd frontend
npm install
npm run dev




source venv/bin/activate


uvicorn service:app --reload --host 127.0.0.1 --port 8000


{
  "email": "test@marginwatch.io",
  "password": "password",
  "full_name": "Test Fucking User"
}

{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyQGV4YW1wbGUuY29tIiwiZXhwIjoxNzQ2NDE0NzUxfQ.WCLlPxw6_b4iwPgJjxb6E1FyvDNsHTHQgodNzoXMvIg",
  "token_type": "bearer"
}